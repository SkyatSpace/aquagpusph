<?xml version="1.0" ?>

<!-- deltaSPH-full.xml
Add a MLS based correction to the Laplacian of the pressure. It is very
expensive, but great results can be expected.
-->

<sphInput>
    <Include file="@RESOURCES_OUTPUT_DIR@/Presets/cfd/MLS.xml" />
    <Variables>
        <Variable name="lap_p_corr" type="vec*" length="N" />
    </Variables>

    <Tools>
        <Tool name="cfd lap p mls" action="insert" before="cfd lap p" type="copy" in="mls_fluid" out="mls"/>
        <Tool name="cfd lap p full" action="insert" before="cfd lap p" type="kernel" entry_point="full" path="@RESOURCES_OUTPUT_DIR@/Scripts/cfd/deltaSPH.cl"/>
        <!-- Correct the Laplacian of the pressure. This operation is a bit
        special, because we should grant that both mls and lap_p_corr
        computations have finished. So it is more convenient to do that
        after the Interactions stage (take care, inserting after is reversing
        the order of the tools) -->
        <Tool name="cfd apply lap p corr" action="insert" after="Interactions" type="kernel" entry_point="lapp_corr" path="@RESOURCES_OUTPUT_DIR@/Scripts/cfd/deltaSPH.cl"/>
        <Tool name="cfd lap p full mls" action="insert" after="Interactions" type="kernel" entry_point="full_mls" path="@RESOURCES_OUTPUT_DIR@/Scripts/cfd/deltaSPH.cl"/>
    </Tools>
</sphInput>
